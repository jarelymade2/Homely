@model StayGo.Models.Propiedad
@using StayGo.Models.Enums

@{
    ViewData["Title"] = "Editar Propiedad";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

@section Styles{
    <style>
        .card-soft{ border-radius:16px; border:1px solid #edf1ee; background:#fff; box-shadow:0 8px 20px rgba(36,48,54,.05); }
        .section-title{ font-weight:700; color:#2f5b45; }
        .form-hint{ font-size:.9rem; color:#6c757d; }
    </style>
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 m-0">Editar propiedad</h2>
    <a asp-area="Admin"
       asp-controller="Propiedad"
       asp-action="Detalles"
       asp-route-id="@Model!.Id"
       class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i> Volver
    </a>
</div>

<form asp-area="Admin" asp-controller="Propiedad" asp-action="Editar" method="post" class="card-soft p-3">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <div asp-validation-summary="ModelOnly" class="text-danger mb-2"></div>

    <div class="row g-3">
        <div class="col-lg-8">
            <div class="mb-3">
                <label class="form-label">Título</label>
                <input asp-for="Titulo" class="form-control" placeholder="Ej: Loft moderno en Miraflores" />
                <span asp-validation-for="Titulo" class="text-danger"></span>
            </div>

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Tipo</label>
                    <select asp-for="Tipo"
                            class="form-select"
                            asp-items="Html.GetEnumSelectList<TipoPropiedad>()"
                            id="tipoSelect"></select>
                    <span class="form-hint">Si es “Hotel”, el precio se gestiona por habitación.</span>
                    <span asp-validation-for="Tipo" class="text-danger"></span>
                </div>
                <div class="col-md-6" id="precioGroup">
                    <label class="form-label">Precio por noche (S/)</label>
                    <input asp-for="PrecioPorNoche" class="form-control" type="number" step="0.01" min="0" placeholder="Ej: 220.00" />
                    <span asp-validation-for="PrecioPorNoche" class="text-danger"></span>
                </div>
            </div>

            <div class="row g-3 mt-1">
                <div class="col-md-6">
                    <label class="form-label">Capacidad</label>
                    <input asp-for="Capacidad" type="number" min="1" class="form-control" placeholder="Ej: 2" />
                    <span asp-validation-for="Capacidad" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Latitud</label>
                    <input asp-for="Lat" type="number" step="0.000001" min="-90" max="90" class="form-control" placeholder="-12.123456" />
                    <span asp-validation-for="Lat" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Longitud</label>
                    <input asp-for="Lng" type="number" step="0.000001" min="-180" max="180" class="form-control" placeholder="-77.012345" />
                    <span asp-validation-for="Lng" class="text-danger"></span>
                </div>
            </div>

            <div class="mt-3">
                <label class="form-label">Descripción</label>
                <textarea asp-for="Descripcion" class="form-control" rows="4" placeholder="Cuenta los detalles más atractivos del alojamiento..."></textarea>
                <span asp-validation-for="Descripcion" class="text-danger"></span>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card-soft p-3 h-100">
                <div class="section-title mb-2">Dirección</div>
                <div class="mb-2">
                    <label class="form-label">Ciudad</label>
                    <input asp-for="Direccion.Ciudad" class="form-control" placeholder="Ej: Lima" />
                </div>
                <div class="mb-2">
                    <label class="form-label">País</label>
                    <input asp-for="Direccion.Pais" class="form-control" placeholder="Ej: Perú" />
                </div>
                <div class="mb-2">
                    <label class="form-label">Código Postal</label>
                    <input asp-for="Direccion.CodigoPostal" class="form-control" placeholder="Ej: 15074" />
                </div>
                <div class="mb-2">
                    <label class="form-label">Línea 1</label>
                    <input asp-for="Direccion.Linea1" class="form-control" placeholder="Ej: Av. El Sol 123" />
                </div>
                <div class="mb-0">
                    <label class="form-label">Línea 2</label>
                    <input asp-for="Direccion.Linea2" class="form-control" placeholder="Depto / referencia" />
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 d-flex flex-wrap gap-2">
        <button class="btn btn-success" type="submit">
            <i class="bi bi-check2 me-1"></i> Guardar
        </button>
        <a asp-area="Admin"
           asp-controller="Propiedad"
           asp-action="Detalles"
           asp-route-id="@Model!.Id"
           class="btn btn-outline-secondary">
            Cancelar
        </a>
        <a asp-area="Admin"
           asp-controller="ImagenPropiedad"
           asp-action="Index"
           asp-route-propiedadId="@Model!.Id"
           class="btn btn-outline-success">
            <i class="bi bi-images me-1"></i> Gestionar imágenes
        </a>
    </div>
</form>

@section Scripts{
<script>
(function(){
  // Toggle del precio cuando el tipo es Hotel
  const tipo = document.getElementById('tipoSelect');
  const precioGroup = document.getElementById('precioGroup');
  const precioInput = precioGroup?.querySelector('input');

  function togglePrecio(){
    if (!tipo || !precioGroup) return;
    const isHotel = (tipo.value || '').toLowerCase() === 'hotel';
    if (isHotel){
      precioGroup.style.opacity = .6;
      if (precioInput){
        precioInput.value = '';
        precioInput.setAttribute('disabled','disabled');
        precioInput.setAttribute('placeholder','(Se define por habitación)');
      }
    } else {
      precioGroup.style.opacity = 1;
      if (precioInput){
        precioInput.removeAttribute('disabled');
        if(!precioInput.value) precioInput.setAttribute('placeholder','Ej: 220.00');
      }
    }
  }
  tipo?.addEventListener('change', togglePrecio);
  togglePrecio();
})();
</script>
}
