@model StayGo.Models.ContactoMensaje
@{
    ViewData["Title"] = "Contacto";
    var isAuth = User?.Identity?.IsAuthenticated == true;
}

<section class="contact-header-light">
    <div class="container text-center py-5">
        <span class="badge contact-badge-pill mb-3">Soporte al Cliente</span>
        <h1 class="hero-title">Contáctanos</h1>
        <p class="hero-sub-light">¿Tienes dudas o necesitas ayuda? Nuestro equipo de soporte está listo para asistirte.</p>
        <a href="#contacto-form" class="btn btn-sage-primary btn-lg px-5 contact-hero-cta lift">
            <i class="bi bi-send-fill me-2"></i>Enviar un Mensaje
        </a>
    </div>

    <div class="header-separator-sage"></div>
</section>

<div class="container py-5 mt-6">
    <div class="row g-5">
        <div class="col-12 col-lg-5">
            <div class="card contact-info-card h-100 border-0">
                <div class="card-body p-4 p-lg-5">
                    <div class="d-flex align-items-center gap-3 mb-4 border-bottom pb-3">
                        <div class="icon-pill-sage"><i class="bi bi-chat-text-fill"></i></div>
                        <h2 class="h4 fw-bold mb-0 text-title-sage">¿Cómo te podemos ayudar?</h2>
                    </div>

                    <ul class="list-unstyled d-grid gap-4 mb-5 mt-4">
                        <li class="d-flex align-items-start gap-3">
                            <div class="icon-soft-sage flex-shrink-0"><i class="bi bi-lightning-charge-fill"></i></div>
                            <div>
                                <div class="fw-semibold text-title-sage">Respuesta Garantizada</div>
                                <small class="text-muted">Generalmente dentro del mismo día hábil. Respondemos todas las consultas.</small>
                            </div>
                        </li>
                        <li class="d-flex align-items-start gap-3">
                            <div class="icon-soft-sage flex-shrink-0"><i class="bi bi-shield-check"></i></div>
                            <div>
                                <div class="fw-semibold text-title-sage">Datos Protegidos</div>
                                <small class="text-muted">Tu información es confidencial y segura. Cumplimos con todas las normativas.</small>
                            </div>
                        </li>
                        <li class="d-flex align-items-start gap-3">
                            <div class="icon-soft-sage flex-shrink-0"><i class="bi bi-envelope-paper-fill"></i></div>
                            <div>
                                <div class="fw-semibold text-title-sage">Seguimiento por Email</div>
                                <small class="text-muted">Recibirás confirmación y te avisaremos inmediatamente sobre cualquier actualización.</small>
                            </div>
                        </li>
                    </ul>

                    <div class="text-center pt-3 border-top border-200">
                        <div class="small text-muted">
                            <i class="bi bi-info-circle me-1"></i>
                            Al enviar aceptas nuestros
                            <a asp-controller="Home" asp-action="Terminos" class="link-sage-color text-decoration-underline link-underline-opacity-75">Términos</a>
                            y
                            <a asp-controller="Home" asp-action="Privacidad" class="link-sage-color text-decoration-underline link-underline-opacity-75">Privacidad</a>.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-7">
            <div class="card contact-form-card shadow-lg border-0 rounded-4">
                <div class="card-body p-5 p-lg-6">
                    <h3 class="h5 fw-bold mb-4 text-center text-lg-start text-title-sage">Completa el Formulario</h3>
                    <form id="contacto-form" asp-action="Index" method="post" class="row g-4" novalidate>
                        <div asp-validation-summary="ModelOnly" class="text-danger small"></div>

                        <div class="col-12 col-md-6">
                            <div class="form-floating fancy-floating-sage">
                                <input asp-for="Nombre" class="form-control form-control-lg" placeholder="Nombre completo" />
                                <label asp-for="Nombre">Nombre</label>
                            </div>
                            <span asp-validation-for="Nombre" class="text-danger small d-block mt-1"></span>
                        </div>

                        <div class="col-12 col-md-6">
                            <div class="form-floating fancy-floating-sage">
                                <input asp-for="Email" class="form-control form-control-lg" placeholder="correo@ejemplo.com" type="email" />
                                <label asp-for="Email">Email</label>
                            </div>
                            <span asp-validation-for="Email" class="text-danger small d-block mt-1"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="Mensaje" class="form-label fw-semibold text-title-sage d-flex justify-content-between">
                                <span>Mensaje / Consulta</span><small class="text-muted"><span id="msgCount">0</span>/500</small>
                            </label>
                            <textarea asp-for="Mensaje" rows="6" maxlength="500"
                                        class="form-control form-control-lg fancy-area-sage"
                                        placeholder="Describe tu consulta, problema o sugerencia. Por favor, sé claro y conciso."></textarea>
                            <span asp-validation-for="Mensaje" class="text-danger small d-block mt-1"></span>
                        </div>

                        @if (isAuth)
                        {
                            <input type="hidden" asp-for="IdentityUserId" />
                            <input type="hidden" asp-for="UsuarioId" />
                        }

                        <div class="col-12 d-flex gap-3">
                            <button class="btn btn-sage-primary btn-lg px-5 lift contact-form-submit" type="submit">
                                <i class="bi bi-send-fill me-2"></i>Enviar Mensaje
                            </button>
                            <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary-sage btn-lg contact-form-cancel">Volver al Inicio</a>
                        </div>
                    </form>
                </div>
            </div>

            <div class="mt-4">
                <h4 class="h6 fw-bold text-muted text-center text-lg-start mb-3">Preguntas Frecuentes</h4>
                <div class="accordion shadow-lg rounded-4 contact-faq-accordion" id="faqContact">
                    <div class="accordion-item border-0">
                        <h2 class="accordion-header">
                            <button class="accordion-button rounded-top-4 fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                <i class="bi bi-question-circle-fill me-3 text-sage"></i>¿En cuánto tiempo responden?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqContact">
                            <div class="accordion-body">
                                Nuestro equipo de soporte trabaja de Lunes a Viernes de 9:00 AM a 6:00 PM (hora local de Lima, Perú). Las consultas enviadas fuera de este horario se priorizan al inicio del siguiente día hábil.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item border-0">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed rounded-bottom-4 fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                <i class="bi bi-question-circle-fill me-3 text-sage"></i>¿Qué debo incluir en el mensaje?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqContact">
                            <div class="accordion-body">
                                Para una respuesta rápida, incluye un resumen conciso de tu problema y si aplica, el código de reserva o ID de propiedad.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div></div></div>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">

    <style>
        :root{
            /* Paleta Sage */
            --sage-50:#f5f7f4; 
            --sage-100:#e9efe6; 
            --sage-200:#dce6d7; 
            --sage-500:#7fa174; 
            --sage-700:#3f6b4f; 
            --sage-800:#2f5b45; 
            --sage-900:#26453a;
            
            /* Colores de texto y fondo */
            --bg-light: var(--sage-50);
            --text-ink: #212529;
            --text-title: var(--sage-900);
            
            /* Acento y Sombra de Sage */
            --primary-sage: var(--sage-700);
            --ring-sage: rgba(63, 107, 79, 0.35);
            --shadow-sage-button: 0 8px 25px rgba(63, 107, 79, 0.3);
            
            /* Utilidades */
            --shadow-xxs: 0 10px 30px rgba(0,0,0,.08), 0 2px 6px rgba(0,0,0,.06);
            --shadow-lg: 0 16px 40px rgba(0,0,0,.12);
            --rounded-lg: 1rem;
        }

        body{
            background-color: var(--bg-light);
            font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
            color: var(--text-ink);
        }

        .text-title-sage { color: var(--text-title); }
        .text-sage { color: var(--sage-700) !important; }
        .border-200 { border-color: var(--sage-200) !important; }

        /* Botón Sage Primary */
        .btn-sage-primary {
            background-color: var(--primary-sage);
            border-color: var(--primary-sage);
            color: white;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .btn-sage-primary:hover {
            background-color: var(--sage-800);
            border-color: var(--sage-800);
            box-shadow: var(--shadow-sage-button);
            color: white;
            transform: translateY(-2px);
        }
        .btn-sage-primary:focus { box-shadow: 0 0 0 .25rem rgba(63, 107, 79, 0.4); }

        .btn-outline-secondary-sage {
            border-color: var(--sage-500);
            color: var(--sage-700);
            font-weight: 600;
        }
        .btn-outline-secondary-sage:hover {
            background-color: var(--sage-100);
            border-color: var(--sage-700);
            color: var(--sage-800);
        }
        
        .link-sage-color { color: var(--sage-700); }
        .link-sage-color:hover { color: var(--sage-800); }

        /* Utilidades */
        .lift{ transition: transform .15s ease, box-shadow .15s ease; }
        .lift:hover{ transform: translateY(-2px); box-shadow: var(--shadow-sage-button); }
        .rounded-4{ border-radius: var(--rounded-lg); }

        /* ---------- HEADER LIMPIO Y LUMINOSO (NUEVO) ---------- */
        .contact-header-light{
            position: relative; 
            padding-bottom: 0;
            /* Degradado muy sutil de Sage a blanco, para luminosidad */
            background: linear-gradient(to bottom, var(--sage-50) 0%, white 100%);
            overflow:hidden;
        }
        .contact-header-light .container{ max-width: 860px; }
        
        /* Línea separadora final (Sutil y profesional) */
        .header-separator-sage {
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, var(--sage-700) 0%, var(--sage-500) 50%, var(--sage-700) 100%);
        }

        .contact-badge-pill {
            background: var(--sage-700) !important; /* Sage más fuerte para que destaque */
            color: white !important;
            padding: 0.4rem 1.2rem;
            font-weight: 600;
            font-size: 0.9rem;
            border-radius: 999px;
            box-shadow: 0 4px 10px rgba(63, 107, 79, 0.2);
        }
        .hero-title{
            font-family: 'Montserrat', sans-serif; /* Título elegante */
            font-weight: 800; letter-spacing: .2px;
            font-size: clamp(2.5rem, 4vw, 3.5rem); margin-bottom: .35rem;
            color: var(--text-title);
        }
        .hero-sub-light{
            color: var(--text-ink);
            font-size: clamp(1rem, 2.2vw, 1.25rem); margin-bottom: 2rem;
        }
        
        /* Eliminamos las olas y el wave path ya no se usan */

        /* ---------- Cards/info izquierda (Sage Style) ---------- */
        .contact-info-card{
            background: white;
            border-radius: 1.5rem; /* Más redondeado */
            box-shadow: 0 12px 35px rgba(38, 69, 58, 0.1);
            border: 1px solid var(--sage-200);
        }

        .icon-pill-sage{
            width:48px;height:48px;border-radius:999px; display:grid; place-items:center;
            background: linear-gradient(135deg, var(--sage-500) 0%, var(--sage-700) 100%);
            color:white; font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(63, 107, 79, 0.4);
        }
        .icon-soft-sage{
            width:40px;height:40px;border-radius:12px; display:grid; place-items:center;
            background: var(--sage-100); color:var(--sage-700); font-size: 1.1rem;
            border: 1px solid var(--sage-200);
        }

        /* ---------- Form base (Sage Focus) ---------- */
        .contact-form-card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 18px 45px rgba(36, 69, 58, 0.15); 
        }
        
        .fancy-floating-sage .form-control,
        .fancy-area-sage {
            border-radius: 1rem;
            border: 1px solid var(--sage-300, #c9d7c2);
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            padding: 1.05rem 1rem .9rem 1rem;
            transition: all 0.2s ease;
        }
        
        .fancy-floating-sage .form-control:focus,
        .fancy-area-sage:focus {
            box-shadow: 0 0 0 .2rem var(--ring-sage);
            border-color: var(--sage-700);
        }
        
        .fancy-floating-sage label { 
            color: #6c757d; 
        }
        
        .fancy-floating-sage .form-control:focus + label,
        .fancy-floating-sage .form-control:not(:placeholder-shown) + label,
        .fancy-floating-sage .form-control:-webkit-autofill + label{
            top: 0; transform: translateY(-58%) scale(.92);
            background: #fff; color: var(--primary-sage); 
            border-radius: .4rem; box-shadow: 0 0 0 2px #fff;
        }

        /* FIX AUTOFILL */
        input:-webkit-autofill,
        textarea:-webkit-autofill,
        select:-webkit-autofill{
            -webkit-box-shadow: 0 0 0 1000px #fff inset !important;
            box-shadow: 0 0 0 1000px #fff inset !important;
            -webkit-text-fill-color: var(--text-ink) !important;
            caret-color: var(--text-ink);
        }
        .fancy-floating-sage .form-control::placeholder{ color: transparent !important; }
        .fancy-area-sage::placeholder{ color:#9aa0a6; opacity:.75; }

        /* ===== Accordión Sage ===== */
        .contact-faq-accordion.accordion{
            --bs-accordion-active-bg:var(--sage-50);
            --bs-accordion-active-color:var(--text-ink);
            --bs-accordion-btn-bg:#fff;
            --bs-accordion-btn-color:var(--text-ink);
            --bs-accordion-border-color:var(--sage-200);
            --bs-accordion-btn-focus-box-shadow:0 0 0 .15rem rgba(63, 107, 79, 0.15);
        }
        .contact-faq-accordion .accordion-item{
            border: 1px solid var(--sage-200);
        }
        .contact-faq-accordion .accordion-button:not(.collapsed){
            background-color: var(--sage-100) !important;
            font-weight: 700 !important;
        }
        .contact-faq-accordion .accordion-button:hover{ background:var(--sage-100); }

        /* Mejorar espaciado del formulario */
        .contact-form-card {
            margin-top: 2rem;
            padding-top: 2rem !important;
        }

        .contact-form-card .card-body {
            padding-top: 3rem !important;
        }

        .contact-form-card h3 {
            margin-top: 0;
            margin-bottom: 2rem;
            padding-top: 1rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .fancy-floating-sage .form-control,
        .fancy-area-sage {
            min-height: 3rem;
        }

        .form-floating > label {
            padding: 1.25rem 0.75rem;
        }

        /* Asegurar que los inputs no se tapen */
        .col-12 {
            margin-bottom: 0.5rem;
        }

        .form-floating {
            margin-bottom: 0.75rem;
        }
    </style>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />
    <script>
        // contador mensaje
        (function(){
            const t = document.getElementById("Mensaje");
            const c = document.getElementById("msgCount");
            if(t && c){ const u=()=>c.textContent=(t.value||"").length; t.addEventListener("input",u); u(); }
        })();

        // Auto-cierre de los avisos globales del Layout (sin tocar el Layout)
        document.addEventListener('DOMContentLoaded', function () {
            const alerts = document.querySelectorAll('.container.mt-3 .alert');
            alerts.forEach(function (el) {
                const delay = el.classList.contains('alert-danger') ? 6000 : 4500; // error tarda más
                setTimeout(function () {
                    try {
                        // Usar el método oficial de Bootstrap para cerrar
                        const bsAlert = (window.bootstrap && bootstrap.Alert && bootstrap.Alert.getOrCreateInstance)
                            ? bootstrap.Alert.getOrCreateInstance(el) : null;
                        if (bsAlert) { bsAlert.close(); }
                        else { el.classList.remove('show'); el.remove(); }
                    } catch (e) {
                        el.classList.remove('show'); el.remove();
                    }
                }, delay);
            });
        });
    </script>
}