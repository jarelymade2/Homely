@model StayGo.Models.Propiedad
@using System.Globalization

@{
    ViewData["Title"] = Model?.Titulo ?? "Propiedad";
    var cover = Model?.Imagenes?.OrderByDescending(i => i.EsPrincipal).FirstOrDefault()?.Url
                ?? "https://placehold.co/1200x360?text=Sin+imagen";
    var pe = new CultureInfo("es-PE");
    var ubic = string.Join(", ",
        new[] { Model?.Direccion?.Ciudad, Model?.Direccion?.Pais }
        .Where(s => !string.IsNullOrWhiteSpace(s)));
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

<div class="container py-4">
  <h2 class="mb-2">@Model?.Titulo</h2>

  <div class="text-muted mb-2">
    <i class="bi bi-geo-alt"></i> @ubic
  </div>

  @if (Model?.PrecioPorNoche.HasValue == true)
  {
    <div class="fw-semibold mb-3">
      @Model!.PrecioPorNoche!.Value.ToString("C", pe) <small class="text-muted">/ noche</small>
    </div>
  }
  else
  {
    <span class="badge text-bg-secondary mb-3">Hotel (precio por habitación)</span>
  }

  <img src="@cover" class="img-fluid rounded mb-3"
       style="object-fit:cover;max-height:360px;width:100%;" alt="@Model?.Titulo" />

  <p>@Model?.Descripcion</p>

  <div class="border rounded p-3 bg-light my-3">
    <strong>Mapa (placeholder)</strong>
    <div class="small text-muted">Lat: @Model?.Lat, Lng: @Model?.Lng</div>
    <div style="height:180px;background:#e9ecef;border-radius:.5rem;"
         class="d-flex align-items-center justify-content-center">
      <span class="text-secondary">[Aquí iría el mapa]</span>
    </div>
  </div>

  <!-- Solo lectura en feat/public -->
  <div class="mb-4">
    <a asp-controller="Propiedad" asp-action="Index" class="btn btn-outline-secondary">
      ← Volver a propiedades
    </a>
  </div>

  <h4>Reseñas (@(Model?.Resenas?.Count ?? 0))</h4>
  @if (Model?.Resenas == null || !Model.Resenas.Any())
  {
    <div class="text-muted">Aún no hay reseñas.</div>
  }
  else
  {
    @foreach (var r in Model.Resenas.OrderByDescending(x => x.Fecha))
    {
      <div class="border-bottom py-2">
        <div class="small text-muted">@r.Fecha.ToShortDateString() — ⭐ @r.Puntuacion/5</div>
        <div>@r.Comentario</div>
      </div>
    }
  }
</div>
